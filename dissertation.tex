\documentclass[10pt,a4paper,twoside,openright]{memoir}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

% ----- pgfplots -----
\usepackage{femtikz} % pgfplots, tikz, graphicx
%\tikzexternalize

% ----- formatting -----
\usepackage{titling}
\usepackage{fancyhdr}
\usepackage{enumitem} % resume
\usepackage{subcaption}
%\usepackage{booktabs}
\OnehalfSpacing % memoir
\nouppercaseheads % memoir
%\setsecnumdepth{subsection} % memoir
%\maxtocdepth{subsection} % memoir
\input{misc/format}

% ----- miscellaneous -----
\usepackage{doi} %necessary?

% ----- work in progress -----
\usepackage{todonotes}
\usepackage{blindtext}
\usepackage{showframe}

% ----- math -----
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{isomath} % \vectorsym, \matrixsym, \tensorsym
%\usepackage{bbold}
\input{misc/math}

% ----- glossary -----
\usepackage[automake]{glossaries-extra}
\makeglossaries
\input{misc/glossary}

% ----- bibliography -----
\usepackage[backend=biber, style=authoryear, labelnumber, defernumbers = true]{biblatex}
\DefineBibliographyStrings{english}{citedas = {hereafter}}
\addbibresource{misc/bibliography.bib}
\addbibresource{misc/references.bib}

% Two bibliographies with different styles and sortings for publications and weblinks, respectively.
%   based on: https://tex.stackexchange.com/questions/299064/

\DeclareSourcemap{
  % append keywords to identify different bibliography entries.
  \maps[datatype=bibtex, overwrite]{
    \map{
      \perdatasource{bibliography.bib}
      \step[fieldset=KEYWORDS, fieldvalue=primary, append]
      % print the following fields only if there is no doi
      \step[fieldsource=doi,final]
      \step[fieldset=url,null]
      \step[fieldset=urldate,null]
      \step[fieldset=isbn,null]
      \step[fieldset=issn,null]
    }
    \map{
      \perdatasource{references.bib}
      \step[fieldset=KEYWORDS, fieldvalue=secondary, append]
      % print the following fields only if there is no doi
      \step[fieldsource=doi,final]
      \step[fieldset=url,null]
      \step[fieldset=urldate,null]
      \step[fieldset=isbn,null]
      \step[fieldset=issn,null]
    }
  }
}

\DeclareFieldFormat{labelnumberwidth}{\mkbibbrackets{#1}}
\defbibenvironment{bibliographyNUM}
{\list
  {\printtext[labelnumberwidth]{%
      \printfield{prefixnumber}%
      \printfield{labelnumber}}}
  {\setlength{\labelwidth}{\labelnumberwidth}%
    \setlength{\leftmargin}{\labelwidth}%
    \setlength{\labelsep}{\biblabelsep}%
    \addtolength{\leftmargin}{\labelsep}%
    \setlength{\itemsep}{\bibitemsep}%
    \setlength{\parsep}{\bibparsep}}%
  \renewcommand*{\makelabel}[1]{\hss##1}}
{\endlist}
{\item}

\assignrefcontextkeyws[sorting=none]{secondary}

% modify cite and textcite macros for 'authoryear'
%   based on: https://github.com/plk/biblatex/blob/dev/tex/latex/biblatex/cbx/authoryear.cbx

\newbibmacro*{cite}{%
  \ifkeyword{secondary}
  % modification for additional bibliography
  {\mkbibbrackets{\printtext[bibhyperref]{%
    \printfield{labelprefix}\printfield{labelnumber}}}}
  % original macro
  {\iffieldundef{shorthand}
  {\ifthenelse{\ifnameundef{labelname}\OR\iffieldundef{labelyear}}
    {\usebibmacro{cite:label}%
      \setunit{\printdelim{nonameyeardelim}}}
    {\printnames{labelname}%
      \setunit{\printdelim{nameyeardelim}}}%
    \usebibmacro{cite:labeldate+extradate}}
  {\usebibmacro{cite:shorthand}}}}

\newbibmacro*{textcite}{%
  \ifkeyword{secondary}
  % modification for additional bibliography
  {\mkbibbrackets{\printtext[bibhyperref]{%
    \printfield{labelprefix}\printfield{labelnumber}}}}
  % original macro
  {\ifnameundef{labelname}
  {\iffieldundef{shorthand}
    {\usebibmacro{cite:label}%
      \setunit{%
        \global\booltrue{cbx:parens}%
        \printdelim{nonameyeardelim}\bibopenparen}%
      \ifnumequal{\value{citecount}}{1}
      {\usebibmacro{prenote}}
      {}%
      \usebibmacro{cite:labeldate+extradate}}
    {\usebibmacro{cite:shorthand}}}
  {\printnames{labelname}%
    \setunit{%
      \global\booltrue{cbx:parens}%
      \printdelim{nameyeardelim}\bibopenparen}%
    \ifnumequal{\value{citecount}}{1}
    {\usebibmacro{prenote}}
    {}%
    \usebibmacro{citeyear}}}}



% --- document information ---
\author{Marc Fehling}
\title{Algorithms for massively parallel hp--adaptive finite element methods}
\date{31. April 2020}



\begin{document}
  \begin{titlingpage}
    \begin{center}
      \vspace*{\fill}
      \includegraphics[width=.75\textwidth]{logos/BUW_Logo-schwarz.eps}\bigskip
      \vspace*{\fill}\vspace*{\fill}\par
      {\Huge \thetitle\bigskip\par}
      {\Huge \theauthor\bigskip\par}
      {\LARGE \thedate\bigskip\bigskip\par}
    \end{center}
    {\large Perfect Publishing\hspace*{\fill}Forward by Fabulous Freddy\smallskip\\
    The World\hspace*{\fill}Author of \emph{Kayaking with dragons}}
  \end{titlingpage}
  
  
  
  \frontmatter
  
  \abstractintoc
  \begin{abstract}
    Abstract.
  \end{abstract}
  \clearpage
  
  % Approval page
  
  \begin{KeepFromToc} % memoir
    \tableofcontents
  \end{KeepFromToc}
  \clearpage
  
  % Dedication
  
  % Acknowledgements
  
  \listoftables
  \clearpage
  
  \listoffigures
  \clearpage
  
  \printglossary[type=\acronymtype, title={List of Abbreviations}]
  
  % Other lists
  
  % Preface
  
  
  
  \mainmatter
  
  \input{chapters/introduction/introduction}
  \input{chapters/parallel/parallel}
  \input{chapters/dynamic/dynamic}
  \input{chapters/results/results}
  \input{chapters/summary/summary}
  
  \appendix
  \glsresetall
  \input{appendix/calculus}
  \input{appendix/enumeration}
  
  
  
  \backmatter
  
  \printbibliography[title=Bibliography, keyword=primary]
  \newrefcontext[sorting=none]
  \printbibliography[env=bibliographyNUM, title=References, keyword=secondary, resetnumbers]
  
  \listoftodos
\end{document}